{% extends "wap/base/base1.html" %}{% block title %}预约量体{% endblock %}{% block extra_css %}{{ block.super }}{% endblock %}{% block extra_js %}	<style type="text/css">	select{		text-align:center;		border-radius:5px;	}	.reserveTime{		position: relative;		height: 7em;	}	.reserveDate{		margin-left: 1em;		position: absolute;		margin-top: 2.3em;		width: 100%;		height: 4em;	}	.reserveInterval{			margin-top: 4.2em;			position: absolute;			margin-left: 0.6em;			width: 100%;			height: 2em;	}	.timeSelect{  width: 4.5em;  height: 2.1em;	}	.hour{  width: 16.8em;  text-align: center;  position: absolute;  height: 2.1em;  margin-top: 0.3em;  margin-left: 0.5em;  margin-right: 1em;	}    .year    {        width:5.5em;    }	</style><script type="text/javascript">	//initialize time select value	$(function(){	//获取当天时间，决定量体时间option		var d = new Date();		var hour = d.getHours()+1;		var currentMonth = d.getMonth()+1;		console.log("hour:"+hour);		var currentDay = d.getDate();		var startDate = currentDay+1;		//initialization		if (hour<=18) {			$("<option>").val("0").html("请选择具体时间").attr("selected",true).appendTo($("#hour"));			$("<option>").val("10:00").html("10:00~12:00").appendTo($("#hour"));			$("<option>").val("12:00").html("12:00~14:00").appendTo($("#hour"));			$("<option>").val("14:00").html("14:00~16:00").appendTo($("#hour"));			$("<option>").val("16:00").html("16:00~18:00").appendTo($("#hour"));			$("<option>").val("18:00").html("18:00~20:00").appendTo($("#hour"));		}		else		{			$("<option>").val("0").html("请选择具体时间").attr("selected",true).appendTo($("#hour"));			$("<option>").val("14:00").html("14:00~16:00").appendTo($("#hour"));			$("<option>").val("16:00").html("16:00~18:00").appendTo($("#hour"));			$("<option>").val("18:00").html("18:00~20:00").appendTo($("#hour"));		}		//initialize month		$("#month option").remove();		for(var i=currentMonth;i<=12;i++)		{			appendToOption("month",i,i-1);		}		//initialize date		$("select[class=date] option").remove();		var daysInMonth = decDaysNumber(currentMonth,2015);    	for (var i = startDate;i<=daysInMonth ;i++) {    		appendToOption("day",i,i-1);    	};						$("#day").change(function(){			var month = $("#month option:selected").html();			var date = $("#day option:selected").html();			$("#hour option").remove();			if(month==currentMonth&&date==startDate&&hour>=18)			{				$("<option>").val("0").html("请选择具体时间").attr("selected",true).appendTo($("#hour"));				$("<option>").val("14:00").html("14:00~16:00").appendTo($("#hour"));				$("<option>").val("16:00").html("16:00~18:00").appendTo($("#hour"));				$("<option>").val("18:00").html("18:00~20:00").appendTo($("#hour"));			}			else{				$("<option>").val("0").html("请选择具体时间").attr("selected",true).appendTo($("#hour"));				$("<option>").val("10:00").html("10:00~12:00").appendTo($("#hour"));				$("<option>").val("12:00").html("12:00~14:00").appendTo($("#hour"));				$("<option>").val("14:00").html("14:00~16:00").appendTo($("#hour"));				$("<option>").val("16:00").html("16:00~18:00").appendTo($("#hour"));				$("<option>").val("18:00").html("18:00~20:00").appendTo($("#hour"));			}		});						$("#month").change(function(){			var month = $("#month option:selected").html();    		console.log("selectmonth:"+month);    		var daysInMonth = decDaysNumber(month,2015);    		console.log("daysInMonth:"+daysInMonth);    		$("#day option").remove();			console.log('currentMonth:'+currentMonth);			console.log("startDate:"+startDate);			if(month>currentMonth)				BeginDate = 1;			else				BeginDate = startDate;			console.log("RealstartDate:"+startDate);    		for (var i = BeginDate;i<=daysInMonth ;i++) {    		appendToOption("day",i,i-1);    		};		});	});	/*根据选择的月份确定当前月的天数*/	function decDaysNumber(month,year)	{		var days =0 ;		if(month==1||month==3||month==5||month==7||month==8||month==10||month==12)		{			days = 31;		}		else if(month==4||month==6||month==9||month==11)		{			days=30;		}		else if(IsLeapYear(year))		{			days = 29;		}		else		{			days =28;		}		return days;	}	/*判断是否是闰年*/	function IsLeapYear(year)	{		var result = false;		if( ( (year%100)&&(!(year%4)) ) || ((!(year%100))&&(!(year%400))) ) 		{			result = true;		}		return result;				}	function appendToOption(id,txt,value)	{		var obj = $("<option>").val(value).text(txt);		console.log("obj:"+obj);		obj.appendTo($("#"+id));	}	</script>		<script>    /*暂时只列出北京市*/    var citylist = {        "province": [            {                "name": "",                "city": [                            {"name": "东城区"},                            {"name": "西城区"},                            {"name": "朝阳区"},                            {"name": "丰台区"},//                            {"name": "石景山区"},                            {"name": "海淀区"},//                            {"name": "门头沟区"},//                            {"name": "房山区"},//                            {"name": "通州区"},//                            {"name": "顺义区"},//                            {"name": "昌平区"},//                            {"name": "大兴区"},//                            {"name": "怀柔区"},//                            {"name": "平谷区" },//                            {"name": "密云县"},//                            {"name": "延庆县" }                ]            }        ]    };    function openSelect(elem){        if(document.createEvent){            var e = document.createEvent("MouseEvents");            e.initMouseEvent("mousedown");            elem[0].dispatchEvent(e);        } else if(elem.fireEvent) {            elem[0].fireEvent("onmousedown");        }    }    function openDateTime(elem){        if(document.createEvent){            var e = document.createEvent("MouseEvents");            e.initMouseEvent("mousedown");            elem[0].dispatchEvent(e);        } else if(elem.fireEvent) {            elem[0].fireEvent("onmousedown");        }    }    var weekMap = new Array("日", "一", "二", "三", "四", "五", "六");    function calcWeek(date){        var arys1= new Array();        arys1=date.split('-');     //日期为输入日期，格式为 2013-3-10        var ssdate=new Date(arys1[0],parseInt(arys1[1]-1),arys1[2]);        return ssdate.getDay();    }    function trimZero(str) {        if(str && str[0] === "0") {            return str.substring(1);        } else {            return str;        }    }    function formatDate(date){        var arys1 = date.split("-");        return trimZero(arys1[0]) + "年" + trimZero(arys1[1]) + "月" + trimZero(arys1[2]) + "日";    }    function reFormatDate(date) {        var sp1 = date.split("年");        var year = sp1[0];        var sp2 = sp1[1].split("月");        var month = sp2[0];        var sp3 = sp2[1].split("日");        var day = sp3[0];        return year + '-' + month + '-' + day;    }    $(function(){        var heightArea = '', weightArea = '';        for(var i = 150;i<=200;i++){            heightArea += "<option value="+i+">"+i+"</option>";        }        for(var j = 45 ;j<=100;j++){            weightArea += "<option value="+j+">"+j+"</option>";        }        $('#category_height').html(heightArea).find('option').eq(20).attr("selected",true);        $('#category_weight').html(weightArea).find('option').eq(15).attr("selected",true);        //北京行政区域划分        var cityArea = '';        var bjcity = citylist.province[0].city.slice();        for(var m = 0;m<bjcity.length;m++){            cityArea += "<option value ="+bjcity[m].name+">"+bjcity[m].name+"</option>";        }        $('#category_address').html(cityArea).find('option').eq(5).attr("selected",true);        $(".sel_wrap").not(".datetime").on("change", function () {            var o;            var opt = $(this).find('option');            opt.each(function (i) {                if (opt[i].selected == true) {                    o = opt[i].innerHTML;                }            })            $(this).find('label').html(o);        }).trigger("change");        $("label.os").on("click", function() {            openSelect($("#" + $(this).attr("for")));        });    })        function popUp(msg){            $('#Popup').css('padding','10px').text(msg).popup("open");        };        function showTips(txt, time, status) {            var htmlCon = '';            if (txt != '') {                if (status != 0 && status != undefined) {                    htmlCon = '<div class="tipsBox" style="width:220px;padding:10px;background-color:#4AAF33;border-radius:4px;-webkit-border-radius: 4px;-moz-border-radius: 4px;color:#fff;box-shadow:0 0 3px #ddd inset;-webkit-box-shadow: 0 0 3px #ddd inset;text-align:center;position:fixed;top:25%;left:50%;z-index:999999;margin-left:-120px;"><img src="/static/images/gouw/ok.png" style="vertical-align: middle;margin-right:5px;" alt="OK，"/>' + txt + '</div>';                } else {                    htmlCon = '<div class="tipsBox" style="width:220px;padding:10px;background-color:#D84C31;border-radius:4px;-webkit-border-radius: 4px;-moz-border-radius: 4px;color:#fff;box-shadow:0 0 3px #ddd inset;-webkit-box-shadow: 0 0 3px #ddd inset;text-align:center;position:fixed;top:25%;left:50%;z-index:999999;margin-left:-120px;"><img src="/static/images/gouw/err.png"" style="vertical-align: middle;margin-right:5px;" alt="Error，"/>' + txt + '</div>';                }                $('body').prepend(htmlCon);                if (time == '' || time == undefined) {                    time = 1500;                }                setTimeout(function () {                    $('.tipsBox').remove();                }, time);            }        }														//       (day < 10) && (day = "0" + day);//        (month < 10) && (month = '0' + month);//        (hours < 10) && (hours = '0' + hours);//        (minutes < 10) && (minutes = '0' + minutes);				    $(function(){        $('.qur').click(function(){            var sex = function(){                var gender = '男';                ($('#gender').parent().find('label').text() == '女士') && (gender = '女');                return gender;            };            var phone = $('#phone').val();            var name = $('#name').val();            var address_region = $('#category_address').val();            var address_street =  $("#category_address_jiedao").val();//            var reservation_time = (($('[type=date]').val()))+' '+($('[type=time]').val());			var year = $("#year option:selected").html();			var month = $("#month option:selected").html();			var day = $("#day option:selected").html();			var timeInterval = $("#hour option:selected").val();			(day < 10) && (day = "0" + day);			(month < 10) && (month = '0' + month);			var reservation_time = year+"-"+month+"-"+day+" "+timeInterval;	//			alert("reservation_time:"+reservation_time);			            if(!name){                showTips("请输入名称!");                return;            }            var isMobile = /^(?:13\d|15\d|18\d)\d{5}(\d{3}|\*{3})$/;            if(!isMobile.test(phone)) {                showTips("请输入正确的手机号!");                return;            }            if(!address_street){                showTips("请输入街道地址!");                return;            }            $.post('/wap/reserve_post/', {                        sex: sex(),                        address_region : address_region,                        address_street : address_street,                        reservation_time: reservation_time,                        name: name,                        phone: phone                    },                    function(returnedData){                        showTips(returnedData.msg, '', 1);                    }            );         });    })    </script>{% endblock %}{% block body %}<div class="header-fixed">    <h1 class="carlogo"><a href="#"><img src="/static/images/public/logo.jpg"></a></h1>    <a href="/wap/cart_view/">        {% if request.session.carts_number != '0' %}        <div class="carnum">            <span class="cnume">{{ request.session.carts_number }}</span>        </div>        {% else %}        <div class="carnum carnum-empty"></div>        {% endif %}    </a></div><div class="gwb">	<div class="gwb_ren">    	<ul>            <li>            	<span>姓名</span>                <p class="p">                    <input type="text" id="name" placeholder="请输入姓名">                </p>            </li>            <li>            	<span>手机号</span>                <p class="p">                    <input type="tel" id="phone" maxlength="11" placeholder="请输入手机号">                </p>            </li>            <li>            	<span>性别</span>                <p class="p sel_wrap" style="margin-right: 0;">                <label for="gender" class="top-layer os txt-right"></label>                <select id="gender" name="gender" class="select">                    <option value="先生" selected="selected">先生</option>                    <option value="女士">女士</option>                </select>                </p>            </li>            <li class="reserveTime">								<span class="timeSpan">预约时间</span>			<div>				<div class="reserveDate">					<select class="timeSelect year"id="year">						<option value="2016" selected>2016</option>					</select>年					<select class="timeSelect month" id="month"></select>月					<select class="timeSelect day" id="day"></select>日				</div>				<div class="reserveInterval">				<select class="hour" id="hour"></select>				</div>			</div>            </li>            <li class="">            	<span class="span" style="padding-bottom: 0">预约地点</span>                <ol class="gwb_list">                    <dl class="row">                        <div class="col-4">                            <select class="sebei select">                                <option value="北京" selected="selected">北京</option>                            </select><p class="sheng">省</p>                        </div>                        <div class="col-4">                            <select class="qu select">                                <option value="北京" selected="selected">北京</option>                            </select><p class="shi">市</p>                        </div>                        <div class="xian col-4 sel_wrap os">                            <label for="category_address" class="top-layer os justify-height"></label>                            <select class="select"  id="category_address"  data-role="none" style="width:80px;">                        </select>                        </div>                        <div class="clearfix"></div>                    </dl>                    <dl style="padding: 0;">                        <input type="text" id="category_address_jiedao" name="newName" placeholder="请输入街道地址"value="" class="ingput_three jeidao"></p>                    </dl>                </ol>            </li>        </ul>    </div>    <div class="clearfix"></div>    <div class="gwb_queren">    	<div class="qur">           提交        </div>    </div></div>{% endblock %}